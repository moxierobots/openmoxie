## EMQX Configuration for OpenMoxie
## =================================

## Node Configuration
node {
  name = "emqx@127.0.0.1"
  cookie = "emqxsecretcookie"
  data_dir = "/opt/emqx/data"
}

## Cluster Configuration
cluster {
  discovery_strategy = static
  static {
    seeds = ["emqx@127.0.0.1"]
  }
}

## MQTT Listeners
listeners.tcp.default {
  bind = "0.0.0.0:1883"
  max_connections = 1000
}

listeners.ssl.default {
  bind = "0.0.0.0:8883"
  max_connections = 1000
  ssl_options {
    keyfile = "/opt/emqx/etc/certs/key.pem"
    certfile = "/opt/emqx/etc/certs/cert.pem"
    cacertfile = "/opt/emqx/etc/certs/cacert.pem"
  }
}

listeners.ws.default {
  bind = "0.0.0.0:8083"
  max_connections = 1000
  websocket.mqtt_path = "/mqtt"
}

listeners.wss.default {
  bind = "0.0.0.0:8084"
  max_connections = 1000
  websocket.mqtt_path = "/mqtt"
  ssl_options {
    keyfile = "/opt/emqx/etc/certs/key.pem"
    certfile = "/opt/emqx/etc/certs/cert.pem"
    cacertfile = "/opt/emqx/etc/certs/cacert.pem"
  }
}

## Authentication - Allow anonymous
authentication = [
  {
    mechanism = anonymous
    enable = true
  }
]

## Authorization - Allow all
authorization {
  sources = [
    {
      type = built_in_database
      enable = true
    }
  ]
  no_match = allow
  deny_action = ignore
  cache {
    enable = true
    max_size = 32
    ttl = 1m
  }
}

## Dashboard
dashboard {
  listeners.http {
    bind = 18083
  }
  default_username = admin
  default_password = public
}

## Management API
api {
  key = "admin"
  secret = "public"
}

## Logging
log {
  console_handler {
    enable = true
    level = debug
    formatter = text
  }
  
  file_handlers.default {
    enable = false
    level = warning
    file = "/opt/emqx/log/emqx.log"
  }
}