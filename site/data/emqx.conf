## EMQX Configuration for OpenMoxie
## =================================

## Node Configuration
node {
  name = "emqx@127.0.0.1"
  cookie = "openmoxie_secure_cookie_2024"
  data_dir = "/opt/emqx/data"
}

## Cluster Configuration
cluster {
  discovery_strategy = static
  static {
    seeds = ["emqx@127.0.0.1"]
  }
}

## MQTT Listeners
listeners.tcp.default {
  bind = "0.0.0.0:1883"
  max_connections = 1000
}

listeners.ssl.default {
  bind = "0.0.0.0:8883"
  max_connections = 1000
  ssl_options {
    keyfile = "/opt/emqx/etc/certs/key.pem"
    certfile = "/opt/emqx/etc/certs/cert.pem"
    cacertfile = "/opt/emqx/etc/certs/cacert.pem"
    verify = verify_none
  }
}

listeners.ws.default {
  bind = "0.0.0.0:8083"
  max_connections = 1000
  websocket.mqtt_path = "/mqtt"
}

listeners.wss.default {
  bind = "0.0.0.0:8084"
  max_connections = 1000
  websocket.mqtt_path = "/mqtt"
  ssl_options {
    keyfile = "/opt/emqx/etc/certs/key.pem"
    certfile = "/opt/emqx/etc/certs/cert.pem"
    cacertfile = "/opt/emqx/etc/certs/cacert.pem"
    verify = verify_none
  }
}

## Authentication - Allow anonymous (EMQX 5.x format)
authentication = []

## Authorization - Allow all (EMQX 5.x format)
authorization {
  sources = []
  no_match = allow
  deny_action = ignore
  cache {
    enable = true
    max_size = 32
    ttl = "1m"
  }
}

## Dashboard
dashboard {
  listeners.http {
    bind = 18083
  }
  default_username = "admin"
  default_password = "public"
}

## API Keys
api_key {
  bootstrap_file = "/opt/emqx/data/api_key_bootstrap.txt"
}

## Logging
log {
  console {
    enable = true
    level = debug
    formatter = text
  }
  
  file {
    default {
      enable = false
      level = warning
      file = "/opt/emqx/log/emqx.log"
    }
  }
}