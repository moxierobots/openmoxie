# Mosquitto MQTT Broker Configuration - Secure Setup
# =====================================================

# Network listeners
# ================
# Secure MQTT over TLS (port 8883)
listener 8883
cafile /mosquitto/config/keys/ca.crt
certfile /mosquitto/config/keys/mosquitto.crt
keyfile /mosquitto/config/keys/mosquitto.key
require_certificate true
use_identity_as_username true

# Local MQTT listener (port 1883) - for internal services only
listener 1883 127.0.0.1
allow_anonymous true

# Security Settings
# ================
# Disable anonymous access on secure port
allow_anonymous false

# Enable authentication
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl

# Connection and Security Limits
# =============================
# Maximum number of concurrent connections
max_connections 100

# Maximum number of inflight messages per client
max_inflight_messages 20

# Maximum packet size (1MB)
max_packet_size 1048576

# Keep alive settings
keepalive_interval 60

# Logging Configuration
# ====================
# Enable verbose logging for better monitoring
log_type error
log_type warning
log_type notice
log_type information
log_type debug

# Log destinations
log_dest stdout
log_dest file /mosquitto/log/mosquitto.log
log_dest topic

# Log format with timestamps
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Persistence Settings
# ===================
# Enable persistence
persistence true
persistence_location /mosquitto/data/

# Auto-save settings
autosave_interval 1800

# Bridge Configuration (if needed)
# ================================
# Uncomment and configure if bridging to other brokers
# Example configuration:
# connection bridge-01
# address remote-broker.example.com:8883
# topic # both 0
# username bridge_user
# password bridge_pass
# cafile /mosquitto/config/keys/ca.crt
# certfile /mosquitto/config/keys/mosquitto.crt
# keyfile /mosquitto/config/keys/mosquitto.key